<!DOCTYPE html>
<html lang="en">

    <head>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" 
                integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" 
                crossorigin="anonymous"
        ></script>

        <script>
            $(function onLoad() {
                $('body > *').hide() // Hide all by default
                let queries = new URLSearchParams(location.search)
                console.log(queries.toString())
                
                // Populate & show section if param exists
                $('div').each(function() {
                    let section = $(this).attr('id')
                    let param = queries.get(section)
                    if (param) {
                        console.log('Showing', section)
                        $('#title').show()
                        $(this).find('p').text(param)
                        $(this).show()
                    }
                })
                
                // Send post request to spotify API, get tokens
                let auth_code = queries.get('code')
                if (auth_code && !queries.get('error')) {
                    let body = {
                        grant_type: 'authorization_code',
                        code: auth_code,
                        redirect_uri: 'https://tobylockley.github.io/spotiauth'
                    }
                    $.post({
                        url: 'https://accounts.spotify.com/api/token',
                        data: body
//                         headers: {
//                             Authorization: `Basic ${}`
//                         }
                    }).always(function(data, status) {
                        console.log('Data:', data)
                        console.log('Status:', status)
                    })
                }
            })
        </script>

        <title>
            Spotify Authentication
        </title>
    </head>

    <body>
            <h3 id="title">Spotify Authentication Details</h3>
            
            <div id="code">
                <h4>Authorization code:</h4>
                <p></p>
                <br><br>
            </div>
            
            <div id="access_token">
                <h4>Access token:</h4>
                <p></p>
                <br><br>
            </div>

            <div id="refresh_token">
                <h4>Refresh token:</h4>
                <p></p>
                <br><br>
            </div>

            <div id="token_type">
                <h4>Token Type:</h4>
                <p></p>
                <br><br>
            </div>

            <div id="expires_in">
                <h4>Expiry (seconds):</h4>
                <p></p>
                <br><br>
            </div>

            <div id="state">
                <h4>Value of state parameter supplied in request:</h4>
                <p></p>
                <br><br>
            </div>

            <div id="error">
                <h4>Error:</h4>
                <p></p>
            </div>
    </body>

    <style>
        body {
            display: flex;
            justify-content: center;
        }
        
        h3 {
            font-family: Helvetica;
            text-decoration: underline;
        }
        
        div {
            max-width: 720px;
            margin-right: auto;
            margin-left: auto;
            font-family: Helvetica;
            text-align: center;
            word-break: break-all;
        }
        
        p {
            font-family: Courier;
        }
    </style>

</html>
